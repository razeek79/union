<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Change Password - الأبطال</title>
    <link rel="stylesheet" href="sc.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="index.html"><img src="https://res.cloudinary.com/dh5jui6pu/image/upload/v1751959954/Screenshot_2025-07-08_130148_kg3qdg.png" class="navimg" /></a>
        <button class="navbar-toggler" style="width: 60px;" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="main.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="students-info.html">Students Info</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="change-password.html">Change Password<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Students Council</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Teachers</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Follow us</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-5" style="font-family: Almarai; color: #02244e;">Change Student Password</h1>
            </div>
        </div>

        <!-- Password Change Form -->
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 col-lg-6">
                <div class="card students-card">
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="students-icon mb-3">
                                <i class="fas fa-key" style="font-size: 3rem; color: #02244e;"></i>
                            </div>
                            <h3 class="card-title" style="font-family: Almarai; color: #02244e;">Password Change Form</h3>
                            <p class="text-muted">Enter student details and new password information</p>
                        </div>
                        
                        <form id="changePasswordForm">
                            <div class="form-group">
                                <label for="cicNo" style="font-family: Almarai; color: #02244e;">CIC No.</label>
                                <input type="text" class="form-control" id="cicNo" placeholder="Enter CIC Number" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="studentName" style="font-family: Almarai; color: #02244e;">Student Name</label>
                                <input type="text" class="form-control" id="studentName" placeholder="Enter student name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="oldPassword" style="font-family: Almarai; color: #02244e;">Old Password</label>
                                <input type="password" class="form-control" id="oldPassword" placeholder="Enter current password" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword" style="font-family: Almarai; color: #02244e;">New Password</label>
                                <input type="password" class="form-control" id="newPassword" placeholder="Enter new password" required>
                                <small class="form-text text-muted">Password must be at least 6 characters long</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword" style="font-family: Almarai; color: #02244e;">Confirm New Password</label>
                                <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm new password" required>
                            </div>
                            
                            <div class="alert alert-info" role="alert">
                                <i class="fas fa-info-circle"></i>
                                <strong>Security Note:</strong> Make sure to use a strong password that includes letters, numbers, and special characters.
                            </div>
                            
                            <button type="submit" class="btn btn-info btn-lg btn-block" style="font-family: Almarai;">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="students-info.html" class="btn btn-secondary btn-lg" style="font-family: Almarai;">
                    <i class="fas fa-arrow-left"></i> Back to Students Info
                </a>
            </div>
        </div>
    </div>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script>
        // Function to get students from localStorage
        function getStudents() {
            const students = localStorage.getItem('students');
            return students ? JSON.parse(students) : [];
        }

        // Function to save students to localStorage
        function saveStudents(students) {
            localStorage.setItem('students', JSON.stringify(students));
        }

        // Function to get student passwords from localStorage
        function getStudentPasswords() {
            const passwords = localStorage.getItem('studentPasswords');
            return passwords ? JSON.parse(passwords) : {};
        }

        // Function to save student passwords to localStorage
        function saveStudentPasswords(passwords) {
            localStorage.setItem('studentPasswords', JSON.stringify(passwords));
        }

        // Change Password Form Handler
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const cicNo = document.getElementById('cicNo').value;
            const studentName = document.getElementById('studentName').value;
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Get existing students
            const students = getStudents();
            const studentPasswords = getStudentPasswords();
            
            // Find student by CIC No. and Name
            const student = students.find(s => 
                s.cicNo === cicNo && s.name.toLowerCase() === studentName.toLowerCase()
            );
            
            if (!student) {
                alert(`Error: No student found with CIC No. ${cicNo} and name "${studentName}".\n\nPlease verify the information and try again.`);
                return;
            }
            
            // Check if old password is correct
            const currentPassword = studentPasswords[cicNo];
            if (!currentPassword) {
                alert(`Error: No password found for student ${studentName}.\n\nThis might be the first time setting a password for this student.`);
                return;
            }
            
            if (currentPassword !== oldPassword) {
                alert(`Error: Incorrect old password for student ${studentName}.\n\nPlease enter the correct current password.`);
                return;
            }
            
            // Validate new password
            if (newPassword.length < 6) {
                alert(`Error: New password must be at least 6 characters long.\n\nPlease choose a stronger password.`);
                return;
            }
            
            // Check if new password matches confirmation
            if (newPassword !== confirmPassword) {
                alert(`Error: New password and confirmation do not match.\n\nPlease make sure both password fields are identical.`);
                return;
            }
            
            // Check if new password is different from old password
            if (newPassword === oldPassword) {
                alert(`Error: New password must be different from the current password.\n\nPlease choose a different password.`);
                return;
            }
            
            // Update password
            studentPasswords[cicNo] = newPassword;
            saveStudentPasswords(studentPasswords);
            
            alert(`Password Changed Successfully!\n\nStudent: ${studentName}\nCIC No.: ${cicNo}\n\nPlease remember to use the new password for future logins.`);
            
            // Reset form
            this.reset();
        });
    </script>
</body>

</html>
